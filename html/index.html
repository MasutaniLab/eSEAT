<!DOCTYPE html>

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html"; charset=utf-8" />
    <title>TEST: COMET Server</title>

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

    <script type="text/javascript">
    <!--

     function long_polling(){
       $.ajax({
         type: "POST",
         url: "comet_request",
         data: "id="+$("input[name='id']").val(),
         dataType: "json",
         success: function(event){
           processEvents(event);
	   if (event.terminate){
	     alert("Tarminate Long_polling..");
	   }else{
             long_polling();
	   }
         }
       });
     }

     function processEvents(event){
       $("#response").html(event.message + " on  " + event.date);
     }

     function sendEvent(){
       $.ajax({
         type: "POST",
         url: "comet_event",
         data: "id="+$("input[name='eid']").val()+"&location=Somewhere",
         dataType: "json",
         success: function(data){
           $("#response2").html(data.result+" on "+data.date);
         }
       });
     }

     function sendEventToRtc(){
       $.ajax({
         type: "POST",
         url: "rtc_onData",
         data: $("input[name='msg']").val(),
         dataType: "json",
         success: function(data){
           $("#response2").html(data.result+" on "+data.date);
         }
       });
     }
    -->
    </script>
  </head>

  <body>

  <h1>This is a test page of COMET server</h1>

  <form name="myform">
    <table>
    <tr>
	    <td>Register Callback : </td>
	    <td> <input type="text" name="id" value="1"> </td>
	    <td> <input type="button" name="b2" value="Register" onClick="long_polling();"> </td>
    </tr>
    <tr>
	    <td>Send Event : </td>
	    <td><input type="text" name="eid" value="1"> </td>
	    <td><input type="button"  value="Call" onClick="sendEvent();"></td>
    </tr>
    <tr>
	    <td>Send Message : </td>
	    <td><input type="text" name="msg" value="TestMessage"> </td>
	    <td><input type="button"  value="Send" onClick="sendEventToRtc();"></td>
    </tr>
    </table>
  </form>

  <h2> RESPONSE</h2>
  <hr>
  <div id="response"></div>
  <hr>
  <div id="response2"></div>
  </body>
</html>

